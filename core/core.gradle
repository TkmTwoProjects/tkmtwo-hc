
apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'checkstyle'
apply plugin: 'findbugs'

compileJava {
  options.compilerArgs << '-Xlint:unchecked,deprecation'
  //options.compilerArgs << '-Xlint:unchecked'
}


dependencies {
  
  compile "com.fasterxml.jackson.core:jackson-databind:${depVersionJackson}"
  compile "com.google.guava:guava:${depVersionGuava}"
  compile "com.tkmtwo:tkmtwo-common:${depVersionTkmTwoCommon}"
  compile "org.apache.httpcomponents:httpclient:4.4.1"
  compile "org.slf4j:slf4j-api:${depVersionSlf4J}"
  compile "org.springframework:spring-web:${depVersionSpringFramework}"

  runtime "org.apache.logging.log4j:log4j-core:${depVersionLog4J2}"
  runtime "org.apache.logging.log4j:log4j-jcl:${depVersionLog4J2}"
  runtime "org.apache.logging.log4j:log4j-jul:${depVersionLog4J2}"
  runtime "org.apache.logging.log4j:log4j-slf4j-impl:${depVersionLog4J2}"
  
  testCompile "junit:junit:${depVersionJunit}"
}

uploadArchives {
  repositories {
    mavenDeployer {
      repository(url: "file://$buildDir/repo")
      //repository(url: "file://$rootDir/../tkmtwo-mvn-repo/release")
    }
  }
}


configurations {
  //all*.exclude group: 'commons-logging'
  all*.exclude group: 'log4j'
  all*.exclude group: 'ch.qos.logback'
}


processTestResources {
  filter (org.apache.tools.ant.filters.ReplaceTokens, tokens: rootProject.ext.projectTokens)
}

jar {
  baseName = rootProject.name
  appendix = project.name
}

javadoc {
  options.author = true
  //options.header = rootProject.name + '-' + project.name
  options.header = rootProject.name
  options.links(project.ext.javadocLinks)
  //title = rootProject.name + '-' + project.name
  title = rootProject.name
}


checkstyle {
  configFile = new File(rootDir, "config/checkstyle.xml")
  sourceSets = [sourceSets.main, sourceSets.test]
}




findbugs {
  //toolVersion = "2.0.1"
  //sourceSets = [sourceSets.test]
  ignoreFailures = true
  reportsDir = file("$project.buildDir/reports/findbugs")
  effort = "max"
  reportLevel = "low"
  //reportLevel = "high"
  //visitors = ["FindSqlInjection", "SwitchFallthrough"]
  //omitVisitors = ["FindNonShortCircuit"]
  //includeFilter = file("$rootProject.projectDir/config/findbugs/includeFilter.xml")
  //excludeFilter = file("$rootProject.projectDir/config/findbugs/excludeFilter.xml")
}


findbugsMain {
  reports {
    xml { enabled = false }
    html {
      enabled = true
      destination "$project.buildDir/reports/findbugs/findbugsMain.html"
    }
  }
}

findbugsTest {
  reports {
    xml { enabled = false }
    html {
      enabled = true
      destination "$project.buildDir/reports/findbugs/findbugsTest.html"
    }
  }
}
